Como evaluadores de penetración, debemos comprender cómo configurar, mantener y proteger las máquinas de ataque Linux y Windows. Según el entorno del cliente o el alcance de la evaluación, es posible que utilicemos una máquina virtual Linux o Windows en nuestra máquina, nuestro sistema operativo base, una caja de Linux en la nube, una máquina virtual instalada dentro del entorno del cliente o incluso realizar pruebas directamente desde un cliente. estación de trabajo propia para simular una amenaza interna (suponiendo un escenario de incumplimiento).

## Estructura de carpetas 

Al atacar un solo entorno de caja, laboratorio o cliente, debemos tener una estructura de carpetas clara en nuestra máquina de ataque para guardar datos tales como: información de alcance, datos de enumeración, evidencia de intentos de explotación, datos confidenciales como credenciales y otros datos obtenidos. durante el reconocimiento, la explotación y la posexplotación. Una estructura de carpetas de muestra puede tener el siguiente aspecto:

![[Pasted image 20230627232151.png]]

Aquí tenemos una carpeta para el cliente `Acme Company`con dos evaluaciones, Prueba de Penetración Interna (IPT) y Prueba de Penetración Externa (EPT). Debajo de cada carpeta, tenemos subcarpetas para guardar datos de escaneo, cualquier herramienta relevante, salida de registro, información de alcance (es decir, listas de IP/redes para alimentar nuestras herramientas de escaneo) y una carpeta de evidencia que puede contener cualquier credencial recuperada durante la evaluación. , cualquier dato relevante recuperado, así como capturas de pantalla.

Es una preferencia personal, pero algunas personas crean una carpeta para cada host de destino y guardan capturas de pantalla dentro de ella. Otros organizan sus notas por host o red y guardan capturas de pantalla directamente en la herramienta para tomar notas. Experimente con estructuras de carpetas y vea qué funciona mejor para mantenerse organizado y trabajar de manera más eficiente.

## Términos comunes

Nos encontraremos con innumerables tecnologías a lo largo de nuestras carreras. Estos son algunos de los términos y tecnologías más comunes con los que nos encontraremos repetidamente y que debemos dominar con firmeza. Esta no es una lista exhaustiva, pero es suficiente para comenzar: 

## Shell o Terminal

`Shell`es un término muy común que escucharemos una y otra vez durante nuestro viaje. Tiene algunos significados. En un sistema Linux, el shell es un programa que recibe información del usuario a través del teclado y pasa estos comandos al sistema operativo para realizar una función específica. En los primeros días de la informática, el shell era la única interfaz disponible para interactuar con los sistemas. Desde entonces, han surgido muchos más tipos y versiones de sistemas operativos junto con la interfaz gráfica de usuario (GUI) para complementar las interfaces de línea de comandos (shell), como la terminal de Linux, la línea de comandos de Windows (cmd.exe) y Windows PowerShell. .

La mayoría de los sistemas Linux utilizan un programa llamado [Bash (Bourne Again Shell)](https://www.gnu.org/savannah-checkouts/gnu/bash/manual/bash.html) como programa shell para interactuar con el sistema operativo. Bash es una versión mejorada de [sh](https://man7.org/linux/man-pages/man1/sh.1p.html) , el programa shell original de los sistemas Unix. Además, `bash`también hay otras shell, que incluyen, entre otras, [Zsh](https://en.wikipedia.org/wiki/Z_shell) , [Tcsh](https://en.wikipedia.org/wiki/Tcsh) , [Ksh](https://en.wikipedia.org/wiki/KornShell) , [Fish shell](https://en.wikipedia.org/wiki/Fish_(Unix_shell)) , etc.

A menudo leemos o escuchamos a otros hablar sobre "poner un caparazón" en una caja (sistema). Esto significa que el host de destino ha sido explotado y hemos obtenido acceso a nivel de shell (normalmente `bash`o `sh`) y podemos ejecutar comandos de forma interactiva como si estuviéramos conectados al host. Se puede obtener un shell explotando una aplicación web o una vulnerabilidad de red/servicio u obteniendo credenciales e iniciando sesión en el host de destino de forma remota. Hay tres tipos principales de conexiones de shell:

![[Pasted image 20230628000532.png]]

Cada tipo de shell tiene su caso de uso, y de la misma manera que hay muchas formas de obtener un shell, el programa de ayuda que usamos para obtener un shell puede estar escrito en muchos lenguajes ( , , , `Python`, `Perl`, `Go`, `Bash`, `Java`etc. `awk`) `PHP`. Estos pueden ser pequeños scripts o programas más grandes y complejos para facilitar una conexión desde el host de destino a nuestro sistema atacante y obtener acceso "shell". El acceso de Shell se discutirá en profundidad en una sección posterior.

## Puerto 

Se puede pensar en un [puerto](https://en.wikipedia.org/wiki/Port_(computer_networking)) como una ventana o puerta en una casa (la casa es un sistema remoto), si una ventana o puerta se deja abierta o no se bloquea correctamente, a menudo podemos obtener acceso no autorizado a una casa. Esto es similar en computación. Los puertos son puntos virtuales donde comienzan y terminan las conexiones de red. Están basados ​​en software y son administrados por el sistema operativo host. Los puertos están asociados con un proceso o servicio específico y permiten que las computadoras diferencien entre diferentes tipos de tráfico (el tráfico SSH fluye a un puerto diferente al de las solicitudes web para acceder a un sitio web, aunque las solicitudes de acceso se envíen a través de la misma conexión de red).

A cada puerto se le asigna un número y muchos están estandarizados en todos los dispositivos conectados a la red (aunque un servicio puede configurarse para ejecutarse en un puerto no estándar). Por ejemplo, `HTTP`los mensajes (tráfico del sitio web) generalmente van al puerto `80`, mientras que `HTTPS`los mensajes van al puerto `443`a menos que se configure de otra manera. Encontraremos aplicaciones web que se ejecutan en puertos no estándar, pero generalmente las encontramos en los puertos 80 y 443. Los números de puerto nos permiten acceder a servicios o aplicaciones específicos que se ejecutan en dispositivos de destino. En un nivel muy alto, los puertos ayudan a las computadoras a comprender cómo manejar los distintos tipos de datos que reciben.

Hay dos categorías de puertos, [Protocolo de control de transmisión (TCP)](https://en.wikipedia.org/wiki/Transmission_Control_Protocol) y [Protocolo de datagramas de usuario (UDP)](https://en.wikipedia.org/wiki/User_Datagram_Protocol) .  
`TCP`está orientado a la conexión, lo que significa que se debe establecer una conexión entre un cliente y un servidor antes de poder enviar los datos. El servidor debe estar en estado de escucha esperando solicitudes de conexión de los clientes.  
`UDP`utiliza un modelo de comunicación sin conexión. No hay "apretón de manos" y, por lo tanto, introduce cierta falta de confiabilidad ya que no hay garantía de entrega de datos. `UDP`es útil cuando la corrección/comprobación de errores no es necesaria o la propia aplicación la maneja.`UDP`es adecuado para aplicaciones que ejecutan tareas sensibles al tiempo, ya que descartar paquetes es más rápido que esperar paquetes retrasados ​​debido a la retransmisión, como es el caso `TCP`y puede afectar significativamente a un sistema en tiempo real. Hay `65,535` `TCP`puertos y `65,535`diferentes `UDP`puertos, cada uno indicado por un número. `TCP`Algunos de los puertos más conocidos `UDP`se enumeran a continuación:

![[Pasted image 20230628003615.png]]

Como profesionales de la seguridad de la información, debemos poder recordar rápidamente grandes cantidades de información sobre una amplia variedad de temas. Es esencial para nosotros, especialmente como pentesters, tener una comprensión firme de muchos `TCP`puertos `UDP`y poder reconocerlos rápidamente solo por su número (es decir, saber que el puerto `21`es `FTP`, el puerto `80`es `HTTP`, el puerto `88`es `Kerberos`) sin tener que buscarlo. . Esto vendrá con la práctica y la repetición y eventualmente se convertirá en una segunda naturaleza a medida que ataquemos más cajas, laboratorios y redes del mundo real y nos ayudará a trabajar de manera más eficiente y priorizar mejor nuestros esfuerzos y ataques de enumeración.

Guías como [esta](https://www.stationx.net/common-ports-cheat-sheet/) y [esta](https://packetlife.net/media/library/23/common-ports.pdf) son excelentes recursos para aprender puertos TCP y UDP estándar y menos comunes. Ponte a prueba para memorizar tantos de estos como sea posible e investiga un poco sobre cada uno de los protocolos enumerados en la tabla anterior. Esta es una excelente [referencia](https://nullsec.us/top-1-000-tcp-and-udp-ports-nmap-default/) sobre los 1000 principales `TCP`y `UDP`los puertos `nmap`junto con los 100 servicios principales analizados por `nmap`.

## Servidor Web

Un servidor web es una aplicación que se ejecuta en el servidor back-end, que maneja todo el `HTTP`tráfico del navegador del lado del cliente, lo enruta a las páginas de destino de las solicitudes y finalmente responde al navegador del lado del cliente. Los servidores web generalmente se ejecutan en puertos TCP `80`o `443`, y son responsables de conectar a los usuarios finales a varias partes de la aplicación web, además de manejar sus diversas respuestas

Como las aplicaciones web tienden a estar abiertas para la interacción pública y están orientadas a Internet, pueden comprometer el servidor de back-end si sufren alguna vulnerabilidad. Las aplicaciones web pueden proporcionar una amplia superficie de ataque, lo que las convierte en un objetivo de gran valor para los atacantes y los pentesters.

Muchos tipos de vulnerabilidades pueden afectar a las aplicaciones web. A menudo oiremos o veremos referencias al [Top 10 de OWASP](https://owasp.org/www-project-top-ten/) . Esta es una lista estandarizada de las 10 principales vulnerabilidades de aplicaciones web mantenidas por Open Web Application Security Project (OWASP). Esta lista se considera las 10 vulnerabilidades más peligrosas y no es una lista exhaustiva de todas las posibles vulnerabilidades de aplicaciones web. Las metodologías de evaluación de la seguridad de las aplicaciones web a menudo se basan en los 10 principales de OWASP como punto de partida para las principales categorías de fallas que un evaluador debe verificar. La lista actual de OWASP Top 10 es:

![[Pasted image 20230628005640.png]]

# Herramientas Básicas

## SSH

[Secure Shell (SSH)](https://en.wikipedia.org/wiki/SSH_(Secure_Shell)) es un protocolo de red que se ejecuta en el puerto `22`de forma predeterminada y brinda a los usuarios, como administradores de sistemas, una forma segura de acceder a una computadora de forma remota. SSH se puede configurar con autenticación de contraseña o sin contraseña mediante [autenticación de clave pública](https://serverpilot.io/docs/how-to-use-ssh-public-key-authentication/) mediante un par de claves pública/privada de SSH. SSH se puede utilizar para acceder de forma remota a sistemas en la misma red, a través de Internet, facilitar las conexiones a recursos en otras redes mediante el reenvío de puertos/proxy, y cargar/descargar archivos hacia y desde sistemas remotos.

SSH usa un modelo cliente-servidor, conectando a un usuario que ejecuta una aplicación de cliente SSH, como `OpenSSH`a un servidor SSH. Mientras atacamos una caja o durante una evaluación del mundo real, a menudo obtenemos credenciales de texto claro o una clave privada SSH que se puede aprovechar para conectarnos directamente a un sistema a través de SSH. Una conexión SSH suele ser mucho más estable que una conexión de shell inversa y, a menudo, se puede usar como un "host de salto" para enumerar y atacar a otros hosts en la red, transferir herramientas, configurar la persistencia, etc. Si obtenemos un conjunto de credenciales , podemos usar SSH para iniciar sesión de forma remota en el servidor usando el nombre de usuario `@`de la IP del servidor remoto, de la siguiente manera:

![[Pasted image 20230629021137.png]]

También es posible leer claves privadas locales en un sistema comprometido o agregar nuestra clave pública para obtener acceso SSH a un usuario específico, como veremos en una sección posterior. Como podemos ver, SSH es una excelente herramienta para conectarse de forma segura a una máquina remota. También proporciona una forma de asignar puertos locales en la máquina remota a nuestro host local, lo que puede resultar útil en ocasiones.

## Netcat

[Netcat](https://linux.die.net/man/1/nc) , `ncat`o `nc`, es una excelente utilidad de red para interactuar con puertos TCP/UDP. Se puede utilizar para muchas cosas durante un pentest. Su uso principal es para conectarse a shells, de lo que hablaremos más adelante en este módulo. Además de eso, `netcat`se puede usar para conectarse a cualquier puerto de escucha e interactuar con el servicio que se ejecuta en ese puerto. Por ejemplo, `SSH`está programado para manejar conexiones a través del puerto 22 para enviar todos los datos y claves. Podemos conectarnos al puerto TCP 22 con `netcat`:

![[Pasted image 20230629021604.png]]




